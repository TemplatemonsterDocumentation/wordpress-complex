!function(t){t(function(){MPHB.CheckoutForm=can.Control.extend({myThis:null},{totalField:null,priceBreakdownTable:null,bookBtn:null,errorsWrapper:null,preloader:null,waitResponse:!1,recalcTotalTimeout:null,init:function(t,e){MPHB.CheckoutForm.myThis=this,this.totalField=this.element.find(".mphb-total-price-field"),this.bookBtn=this.element.find("input[type=submit]"),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader"),this.priceBreakdownTable=this.element.find("table.mphb-price-breakdown")},setTotal:function(t){this.totalField.html(t)},setupPriceBreakdown:function(t){this.priceBreakdownTable=this.priceBreakdownTable.replaceWith(t),this.priceBreakdownTable=this.element.find("table.mphb-price-breakdown")},setRate:function(t){this.recalculatePrices()},recalculatePrices:function(){var e=this;e.hideErrors(),e.showPreloader(),clearTimeout(this.recalcTotalTimeout),this.recalcTotalTimeout=setTimeout(function(){var a=e.parseFormToJSON();t.ajax({url:MPHB._data.ajaxUrl,type:"GET",dataType:"json",data:{action:"mphb_recalculate_checkout_prices",mphb_nonce:MPHB._data.nonces.mphb_recalculate_checkout_prices,formValues:a},success:function(t){t.hasOwnProperty("success")?t.success?(e.setTotal(t.data.total),e.setupPriceBreakdown(t.data.priceBreakdown)):e.showError(t.data.message):e.showError(MPHB._data.translations.errorHasOccured)},error:function(t){e.showError(MPHB._data.translations.errorHasOccured)},complete:function(t){e.hidePreloader()}})},500)},'[name="mphb_room_rate_id"] change':function(t,e){var a=t.val();this.setRate(a)},".mphb_sc_checkout-services-list input, .mphb_sc_checkout-services-list select change":function(t,e){this.recalculatePrices()},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},showError:function(t){this.errorsWrapper.html(t).removeClass("mphb-hide")},showPreloader:function(){this.waitResponse=!0,this.bookBtn.attr("disabled","disabled"),this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.waitResponse=!1,this.bookBtn.removeAttr("disabled"),this.preloader.addClass("mphb-hide")},parseFormToJSON:function(){return this.element.serializeJSON()},submit:function(t,e){if(this.waitResponse)return!1}}),MPHB.DateRules=can.Construct.extend({},{dates:{},init:function(t){this.dates=t},canCheckIn:function(t){var e=this.formatDate(t);return!this.dates.hasOwnProperty(e)||!this.dates[e].not_check_in&&!this.dates[e].not_stay_in},canCheckOut:function(t){var e=this.formatDate(t);return!this.dates.hasOwnProperty(e)||!this.dates[e].not_check_out},canStayIn:function(t){var e=this.formatDate(t);return!this.dates.hasOwnProperty(e)||!this.dates[e].not_stay_in},getNearestNotStayInDate:function(e,a){var i=new Date(a),n=t.datepick.formatDate("yyyy-mm-dd",e),r=t.datepick.formatDate("yyyy-mm-dd",a);return t.each(this.dates,function(t,e){return!(t>r)&&(n>t||(e.not_stay_in?(i=new Date(t),!1):void 0))}),i},formatDate:function(e){return t.datepick.formatDate("yyyy-mm-dd",e)}}),MPHB.Datepicker=can.Control.extend({},{form:null,init:function(t,e){this.form=e.form},getRawDate:function(){var e=this.element.val(),a=[];return""!==e&&t.each(e.split(","),function(t,e){a.push(new Date(e))}),a},getDate:function(){var t=this.element.val();return""!==t?new Date(t):null},getFormattedDate:function(){return this.element.val()},setDate:function(t){this.element.datepick("setDate",t)},getOption:function(t){return this.element.datepick("option",t)},setOption:function(t,e){this.element.datepick("option",t,e)},getMinDate:function(){var t=this.getOption("minDate");return null!==t&&""!==t?new Date(t):null},getMaxDate:function(){var t=this.getOption("maxDate");return null!==t&&""!==t?new Date(t):null},clear:function(){this.element.datepick("clear")},formatDate:function(e,a){return a="undefined"!=typeof a?a:"yyyy-mm-dd",t.datepick.formatDate(a,e)},refresh:function(){t.datepick._update(this.element[0],!0),t.datepick._updateInput(this.element[0],!1)}}),MPHB.GlobalRules=can.Construct.extend({},{minDays:null,maxDays:null,checkInDays:null,checkOutDays:null,init:function(t){this.minDays=t.min_days,this.maxDays=t.max_days,this.checkInDays=t.check_in_days,this.checkOutDays=t.check_out_days},isCheckOutSatisfy:function(e){var a=e.getDay().toString();return t.inArray(a,this.checkOutDays)!==-1},isCheckInSatisfy:function(e){var a=e.getDay().toString();return t.inArray(a,this.checkInDays)!==-1},isCorrect:function(e,a){if("undefined"==typeof e||"undefined"==typeof a)return!0;if(!this.isCheckInSatisfy(e))return!1;if(!this.isCheckOutSatisfy(a))return!1;var i=t.datepick.add(new Date(e.getTime()),this.minDays),n=t.datepick.add(new Date(e.getTime()),this.maxDays);return a>=i&&a<=n},getMinCheckOutDate:function(e){return t.datepick.add(new Date(e.getTime()),this.minDays,"d")},getMaxCheckOutDate:function(e){return t.datepick.add(new Date(e.getTime()),this.maxDays,"d")}}),MPHB.HotelDataManager=can.Construct.extend({myThis:null,ROOM_STATUS_AVAILABLE:"available",ROOM_STATUS_NOT_AVAILABLE:"not-available",ROOM_STATUS_BOOKED:"booked",ROOM_STATUS_PAST:"past"},{today:null,roomTypesData:{},globalRules:null,dateRules:null,init:function(t){MPHB.HotelDataManager.myThis=this,this.initRoomTypesData(t.room_types_data),this.initRules(t.rules),this.setToday(new Date(t.today))},initRoomTypesData:function(e){var a=this;t.each(e,function(t,e){a.roomTypesData[t]=new MPHB.RoomTypeData(t,e)})},initRules:function(t){this.globalRules=new MPHB.GlobalRules(t.global),this.dateRules=new MPHB.DateRules(t.dates)},setToday:function(t){this.today=t},getRoomTypeData:function(t){return!!this.roomTypesData.hasOwnProperty(t)&&this.roomTypesData[t]},fillDateCellData:function(t,e){var a=[],i=[];return this.dateRules.canStayIn(e)||(a.push(MPHB._data.translations.notStayIn),i.push("mphb-not-stay-in-date")),this.dateRules.canCheckIn(e)&&this.globalRules.isCheckInSatisfy(e)||(a.push(MPHB._data.translations.notCheckIn),i.push("mphb-not-check-in-date")),this.dateRules.canCheckOut(e)&&this.globalRules.isCheckOutSatisfy(e)||(a.push(MPHB._data.translations.notCheckOut),i.push("mphb-not-check-out-date")),a.length&&(t.title+=" "+MPHB._data.translations.rules+" "+a.join(", ")),i.length&&(t.dateClass+=(t.dateClass.length?" ":"")+i.join(" ")),t}}),MPHB.Utils=can.Construct.extend({formatDateToCompare:function(e){return t.datepick.formatDate("yyyymmdd",e)}},{}),MPHB.ReservationForm=can.Control.extend({MODE_SUBMIT:"submit",MODE_NORMAL:"normal",MODE_WAITING:"waiting"},{formEl:null,checkInDatepicker:null,checkOutDatepicker:null,reserveBtn:null,reserveBtnPreloader:null,errorsWrapper:null,mode:null,roomTypeId:null,roomTypeData:null,setup:function(t,e){this._super(t,e),this.mode=MPHB.ReservationForm.MODE_NORMAL},init:function(e,a){this.formEl=e,this.roomTypeId=parseInt(this.formEl.attr("id").replace(/^booking-form-/,"")),this.roomTypeData=MPHB.HotelDataManager.myThis.getRoomTypeData(this.roomTypeId),this.errorsWrapper=this.formEl.find(".mphb-errors-wrapper"),this.initCheckInDatepicker(),this.initCheckOutDatepicker(),this.initReserveBtn();var i=this;t(window).on("mphb-update-date-room-type-"+this.roomTypeId,function(){i.reservationForm.refreshDatepickers()})},submit:function(e,a){if(this.mode!==MPHB.ReservationForm.MODE_SUBMIT){a.preventDefault(),a.stopPropagation(),this.setFormWaitingMode();var i=this;t.ajax({url:MPHB._data.ajaxUrl,type:"GET",dataType:"json",data:{action:"mphb_check_room_availability",mphb_nonce:MPHB._data.nonces.mphb_check_room_availability,roomTypeId:i.roomTypeId,checkInDate:this.checkInDatepicker.getFormattedDate(),checkOutDate:this.checkOutDatepicker.getFormattedDate()},success:function(t){t.hasOwnProperty("success")?t.success?i.proceedToCheckout():(i.showError(t.data.message),t.data.hasOwnProperty("updatedData")&&i.roomTypeData.update(t.data.updatedData),i.clearDatepickers()):i.showError(MPHB._data.translations.errorHasOccured)},error:function(t){i.showError(MPHB._data.translations.errorHasOccured)},complete:function(t){i.setFormNormalMode()}})}},proceedToCheckout:function(){this.mode=MPHB.ReservationForm.MODE_SUBMIT,this.unlock(),this.formEl.submit()},showError:function(e){this.clearErrors();var a=t("<p>",{class:"mphb-error",html:e});this.errorsWrapper.append(a).removeClass("mphb-hide")},clearErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},lock:function(){this.element.find("[name]").attr("disabled","disabled"),this.reserveBtn.attr("disabled","disabled").addClass("mphb-disabled"),this.reserveBtnPreloader.removeClass("mphb-hide")},unlock:function(){this.element.find("[name]").removeAttr("disabled"),this.reserveBtn.removeAttr("disabled","disabled").removeClass("mphb-disabled"),this.reserveBtnPreloader.addClass("mphb-hide")},setFormWaitingMode:function(){this.mode=MPHB.ReservationForm.MODE_WAITING,this.lock()},setFormNormalMode:function(){this.mode=MPHB.ReservationForm.MODE_NORMAL,this.unlock()},initCheckInDatepicker:function(){var t=this.formEl.find("input[name=mphb_check_in_date]");this.checkInDatepicker=new MPHB.RoomTypeCheckInDatepicker(t,{form:this})},initCheckOutDatepicker:function(){var t=this.formEl.find("input[name=mphb_check_out_date]");this.checkOutDatepicker=new MPHB.RoomTypeCheckOutDatepicker(t,{form:this})},initReserveBtn:function(){this.reserveBtn=this.formEl.find(".mphb-reserve-btn"),this.reserveBtnPreloader=this.formEl.find(".mphb-preloader"),this.setFormNormalMode()},updateCheckOutLimitations:function(t){"undefined"==typeof t&&(t=!0);var e=this.retrieveCheckOutLimitations(this.checkInDatepicker.getDate(),this.checkOutDatepicker.getDate());this.checkOutDatepicker.setOption("minDate",e.minDate),this.checkOutDatepicker.setOption("maxDate",e.maxDate),this.checkOutDatepicker.setDate(t?e.date:null)},retrieveCheckOutLimitations:function(t,e){var a=MPHB.HotelDataManager.myThis.today,i=null,n=null;if(null!==t){var a=MPHB.HotelDataManager.myThis.globalRules.getMinCheckOutDate(t),i=MPHB.HotelDataManager.myThis.globalRules.getMaxCheckOutDate(t);i=this.roomTypeData.getNearestLockedDate(t,i),i=this.roomTypeData.getNearestHaveNotPriceDate(t,i),i=MPHB.HotelDataManager.myThis.dateRules.getNearestNotStayInDate(t,i),n=this.isCheckOutDateNotValid(e,a,i)?this.retrieveRecommendedCheckOutDate(a,i):e}return{minDate:a,maxDate:i,date:n}},retrieveRecommendedCheckOutDate:function(e,a){for(var i=null,n=new Date(e);MPHB.Utils.formatDateToCompare(n)<=MPHB.Utils.formatDateToCompare(a);){var r=t.datepick.formatDate("yyyy-mm-dd",t.datepick.add(new Date(n),-1,"d"));if(!this.isCheckOutDateNotValid(n,e,a)&&this.roomTypeData.hasPriceForDate(r)){i=n;break}n=t.datepick.add(n,1,"d")}return i},isCheckOutDateNotValid:function(t,e,a){return null===t||MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(e)||MPHB.Utils.formatDateToCompare(t)>MPHB.Utils.formatDateToCompare(a)||!MPHB.HotelDataManager.myThis.globalRules.isCheckOutSatisfy(t)||!MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t)},clearDatepickers:function(){this.checkInDatepicker.clear(),this.checkOutDatepicker.clear()},refreshDatepickers:function(){this.checkInDatepicker.refresh(),this.checkOutDatepicker.refresh()}}),MPHB.RoomTypeCalendar=can.Control.extend({},{roomTypeData:null,roomTypeId:null,init:function(e,a){this.roomTypeId=parseInt(e.attr("id").replace(/^mphb-calendar-/,"")),this.roomTypeData=MPHB.HotelDataManager.myThis.getRoomTypeData(this.roomTypeId);var i=this;e.hide().datepick({onDate:function(t,e){var a={selectable:!1,dateClass:"mphb-date-cell",title:""};return e?a=i.roomTypeData.fillDateData(a,t):a.dateClass+=" mphb-extra-date",a},minDate:MPHB.HotelDataManager.myThis.today,monthsToShow:MPHB._data.settings.numberOfMonthCalendar,firstDay:MPHB._data.settings.firstDay}).show(),t(window).on("mphb-update-room-type-data-"+this.roomTypeId,function(t){i.refresh()})},refresh:function(){this.element.hide(),t.datepick._update(this.element[0],!0),this.element.show()}}),MPHB.RoomTypeCheckInDatepicker=MPHB.Datepicker.extend({},{init:function(t,e){this._super(t,e);var a=this;this.element.datepick({onDate:function(t,e){var i={dateClass:"mphb-date-cell",selectable:!1,title:""};if(e){var n=a.form.roomTypeData.getDateStatus(t);i=a.form.roomTypeData.fillDateData(i,t);var r=n===MPHB.HotelDataManager.ROOM_STATUS_AVAILABLE&&MPHB.HotelDataManager.myThis.globalRules.isCheckInSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckIn(t);r&&(i.selectable=!0)}else i.dateClass+=" mphb-extra-date";return i.selectable&&(i.dateClass+=" mphb-date-selectable"),i},onSelect:function(t){a.form.updateCheckOutLimitations()},minDate:MPHB.HotelDataManager.myThis.today,monthsToShow:MPHB._data.settings.numberOfMonthDatepicker,pickerClass:"mphb-datepick-popup mphb-check-in-datepick",firstDay:MPHB._data.settings.firstDay})},setDate:function(t){return null==t?this._super(t):MPHB.HotelDataManager.myThis.globalRules.isCheckInSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckIn(t)?this._super(t):this._super(null)}}),MPHB.RoomTypeCheckOutDatepicker=MPHB.Datepicker.extend({},{init:function(t,e){this._super(t,e);var a=this;this.element.datepick({onDate:function(t,e){var i={dateClass:"mphb-date-cell",selectable:!1,title:""};if(e){var n=a.form.checkInDatepicker.getDate(),r=null!==a.getMinDate()&&MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(a.getMinDate()),s=null!==a.getMaxDate()&&MPHB.Utils.formatDateToCompare(t)>MPHB.Utils.formatDateToCompare(a.getMaxDate());if(null!==n&&MPHB.Utils.formatDateToCompare(t)===MPHB.Utils.formatDateToCompare(n)&&(i.dateClass+=" mphb-check-in-date",i.title+=MPHB._data.translations.checkInDate),r){var o=MPHB.HotelDataManager.myThis.globalRules.getMinCheckOutDate(n);MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(n)?i.dateClass+=" mphb-earlier-min-date mphb-earlier-check-in-date":MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(o)&&(i.dateClass+=" mphb-earlier-min-date",i.title+=(i.title.length?" ":"")+MPHB._data.translations.lessThanMinDaysStay)}if(s){var l=MPHB.HotelDataManager.myThis.globalRules.getMaxCheckOutDate(n);MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(l)?i.title+=(i.title.length?" ":"")+MPHB._data.translations.laterThanMaxDate:i.title+=(i.title.length?" ":"")+MPHB._data.translations.moreThanMaxDaysStay,i.dateClass+=" mphb-later-max-date"}i=a.form.roomTypeData.fillDateData(i,t);var c=!r&&!s&&MPHB.HotelDataManager.myThis.globalRules.isCheckOutSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t);c&&(i.selectable=!0)}else i.dateClass+=" mphb-extra-date";return i.selectable?i.dateClass+=" mphb-selectable-date":i.dateClass+=" mphb-unselectable-date",i},minDate:MPHB.HotelDataManager.myThis.today,monthsToShow:MPHB._data.settings.numberOfMonthDatepicker,pickerClass:"mphb-datepick-popup mphb-check-out-datepick",firstDay:MPHB._data.settings.firstDay})},setDate:function(t){return null==t?this._super(t):MPHB.HotelDataManager.myThis.globalRules.isCheckOutSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t)?this._super(t):this._super(null)}}),MPHB.RoomTypeData=can.Construct.extend({},{id:null,bookedDates:{},havePriceDates:{},activeRoomsCount:0,init:function(t,e){this.id=t,this.setRoomsCount(e.activeRoomsCount),this.setDates(e.dates)},update:function(e){e.hasOwnProperty("activeRoomsCount")&&this.setRoomsCount(e.activeRoomsCount),e.hasOwnProperty("dates")&&this.setDates(e.dates),t(window).trigger("mphb-update-room-type-data-"+this.id)},setRoomsCount:function(t){this.activeRoomsCount=t},setDates:function(t){this.bookedDates=t.hasOwnProperty("booked")?t.booked:{},this.havePriceDates=t.hasOwnProperty("havePrice")?t.havePrice:{}},isAvailable:function(t){var e=this.getLockedDates();return!e.hasOwnProperty(t)||e[t]<this.activeRoomsCount},isBooked:function(t){var e=this.getLockedDates();return!e.hasOwnProperty(t)||e[t]<this.activeRoomsCount},getNearestLockedDate:function(e,a){var i=a,n=this,r=t.datepick.formatDate("yyyy-mm-dd",e),s=t.datepick.formatDate("yyyy-mm-dd",a);return t.each(n.getLockedDates(),function(t,e){return!(s<t)&&(r>t||(e>=n.activeRoomsCount?(i=new Date(t),!1):void 0))}),i},getNearestHaveNotPriceDate:function(e,a){for(var i=new Date(a),n=new Date(e);MPHB.Utils.formatDateToCompare(n)<=MPHB.Utils.formatDateToCompare(a);){if(!this.hasPriceForDate(t.datepick.formatDate("yyyy-mm-dd",n))){i=n;break}n=t.datepick.add(n,1,"d")}return i},getLockedDates:function(){var e={};return t.extend(e,this.bookedDates)},getHavePriceDates:function(){var e={};return t.extend(e,this.havePriceDates)},getDateStatus:function(e){var a=t.datepick.formatDate("yyyy-mm-dd",e),i=MPHB.HotelDataManager.ROOM_STATUS_AVAILABLE;return this.isEarlierThanToday(a)?i=MPHB.HotelDataManager.ROOM_STATUS_PAST:this.bookedDates.hasOwnProperty(a)&&this.bookedDates[a]>=this.activeRoomsCount?i=MPHB.HotelDataManager.ROOM_STATUS_BOOKED:this.hasPriceForDate(a)||(i=MPHB.HotelDataManager.ROOM_STATUS_NOT_AVAILABLE),i},hasPriceForDate:function(e){return t.inArray(e,this.havePriceDates)!==-1},getAvailableRoomsCount:function(e){var a=t.datepick.formatDate("yyyy-mm-dd",e),i=this.bookedDates.hasOwnProperty(a)?this.activeRoomsCount-this.bookedDates[a]:this.activeRoomsCount;return i<0&&(i=0),i},fillDateData:function(t,e){var a=this.getDateStatus(e),i=[],n=[];switch(a){case MPHB.HotelDataManager.ROOM_STATUS_PAST:n.push("mphb-past-date"),i.push(MPHB._data.translations.past);break;case MPHB.HotelDataManager.ROOM_STATUS_AVAILABLE:n.push("mphb-available-date"),i.push(MPHB._data.translations.available+"("+this.getAvailableRoomsCount(e)+")");break;case MPHB.HotelDataManager.ROOM_STATUS_NOT_AVAILABLE:n.push("mphb-not-available-date"),i.push(MPHB._data.translations.notAvailable);break;case MPHB.HotelDataManager.ROOM_STATUS_BOOKED:n.push("mphb-booked-date"),i.push(MPHB._data.translations.booked)}return t.dateClass+=(t.dateClass.length?" ":"")+n.join(" "),t.title+=(t.title.length?", ":"")+i.join(", "),t=MPHB.HotelDataManager.myThis.fillDateCellData(t,e)},appendRulesToTitle:function(t,e){var a=[];return MPHB.HotelDataManager.myThis.dateRules.canStayIn(t)||a.push(MPHB._data.translations.notStayIn),MPHB.HotelDataManager.myThis.dateRules.canCheckIn(t)||a.push(MPHB._data.translations.notCheckIn),MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t)||a.push(MPHB._data.translations.notCheckOut),a.length&&(e+=" "+MPHB._data.translations.rules+" "+a.join(", ")),e},isEarlierThanToday:function(t){var e=new Date(t);return MPHB.Utils.formatDateToCompare(e)<MPHB.Utils.formatDateToCompare(MPHB.HotelDataManager.myThis.today)}}),MPHB.SearchCheckInDatepicker=MPHB.Datepicker.extend({},{init:function(t,e){this._super(t,e);var a=this;t.datepick({onSelect:function(t){a.form.updateCheckOutLimitations()},onDate:function(t,e){var a={dateClass:"mphb-date-cell",selectable:!1,title:""};if(e){var i=MPHB.HotelDataManager.myThis.globalRules.isCheckInSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckIn(t);i&&(a.selectable=!0),a=MPHB.HotelDataManager.myThis.fillDateCellData(a,t)}else a.dateClass+=" mphb-extra-date";return a.selectable?a.dateClass+=" mphb-selectable-date":a.dateClass+=" mphb-unselectable-date",a},minDate:MPHB.HotelDataManager.myThis.today,monthsToShow:MPHB._data.settings.numberOfMonthDatepicker,firstDay:MPHB._data.settings.firstDay,pickerClass:"mphb-datepick-popup mphb-check-in-datepick"})}}),MPHB.SearchCheckOutDatepicker=MPHB.Datepicker.extend({},{init:function(t,e){this._super(t,e);var a=this;t.datepick({onDate:function(t,e){var i={dateClass:"mphb-date-cell",selectable:!1,title:""};if(e){var n=a.form.checkInDatepicker.getDate(),r=null!==a.getMinDate()&&MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(a.getMinDate()),s=null!==a.getMaxDate()&&MPHB.Utils.formatDateToCompare(t)>MPHB.Utils.formatDateToCompare(a.getMaxDate());if(null!==n&&MPHB.Utils.formatDateToCompare(t)===MPHB.Utils.formatDateToCompare(n)&&(i.dateClass+=" mphb-check-in-date",i.title+=MPHB._data.translations.checkInDate),r&&(MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(n)?i.dateClass+=" mphb-earlier-min-date mphb-earlier-check-in-date":(i.dateClass+=" mphb-earlier-min-date",i.title+=(i.title.length?" ":"")+MPHB._data.translations.lessThanMinDaysStay)),s){var o=MPHB.HotelDataManager.myThis.globalRules.getMaxCheckOutDate(n);MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(o)?i.title+=(i.title.length?" ":"")+MPHB._data.translations.laterThanMaxDate:i.title+=(i.title.length?" ":"")+MPHB._data.translations.moreThanMaxDaysStay,i.dateClass+=" mphb-later-max-date"}i=MPHB.HotelDataManager.myThis.fillDateCellData(i,t);var l=!r&&!s&&MPHB.HotelDataManager.myThis.globalRules.isCheckOutSatisfy(t)&&MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t);l&&(i.selectable=!0)}else i.dateClass+=" mphb-extra-date";return i.selectable?i.dateClass+=" mphb-selectable-date":i.dateClass+=" mphb-unselectable-date",i},onSelect:function(t){},minDate:MPHB.HotelDataManager.myThis.today,monthsToShow:MPHB._data.settings.numberOfMonthDatepicker,firstDay:MPHB._data.settings.firstDay,pickerClass:"mphb-datepick-popup mphb-check-in-datepick"})}}),MPHB.SearchForm=can.Control.extend({},{checkInDatepickerEl:null,checkOutDatepickerEl:null,checkInDatepicker:null,checkOutDatepicker:null,init:function(t,e){this.checkInDatepickerEl=this.element.find(".mphb-datepick[name=mphb_check_in_date]"),this.checkOutDatepickerEl=this.element.find(".mphb-datepick[name=mphb_check_out_date]"),this.checkInDatepicker=new MPHB.SearchCheckInDatepicker(this.checkInDatepickerEl,{form:this}),this.checkOutDatepicker=new MPHB.SearchCheckOutDatepicker(this.checkOutDatepickerEl,{form:this})},updateCheckOutLimitations:function(t){"undefined"==typeof t&&(t=!0);var e=this.retrieveCheckOutLimitations(this.checkInDatepicker.getDate(),this.checkOutDatepicker.getDate());this.checkOutDatepicker.setOption("minDate",e.minDate),this.checkOutDatepicker.setOption("maxDate",e.maxDate),this.checkOutDatepicker.setDate(t?e.date:null)},retrieveCheckOutLimitations:function(t,e){var a=MPHB.HotelDataManager.myThis.today,i=null,n=null;if(null!==t){var a=MPHB.HotelDataManager.myThis.globalRules.getMinCheckOutDate(t),i=MPHB.HotelDataManager.myThis.globalRules.getMaxCheckOutDate(t);i=MPHB.HotelDataManager.myThis.dateRules.getNearestNotStayInDate(t,i),n=this.isCheckOutDateNotValid(e,a,i)?this.retrieveRecommendedCheckOutDate(a,i):e}return{minDate:a,maxDate:i,date:n}},retrieveRecommendedCheckOutDate:function(e,a){for(var i=null,n=new Date(e);MPHB.Utils.formatDateToCompare(n)<=MPHB.Utils.formatDateToCompare(a);){if(!this.isCheckOutDateNotValid(n,e,a)){i=n;break}n=t.datepick.add(n,1,"d")}return i},isCheckOutDateNotValid:function(t,e,a){return null===t||MPHB.Utils.formatDateToCompare(t)<MPHB.Utils.formatDateToCompare(e)||MPHB.Utils.formatDateToCompare(t)>MPHB.Utils.formatDateToCompare(a)||!MPHB.HotelDataManager.myThis.globalRules.isCheckOutSatisfy(t)||!MPHB.HotelDataManager.myThis.dateRules.canCheckOut(t)}}),new MPHB.HotelDataManager(MPHB._data),MPHB._data.page.isCheckoutPage&&new MPHB.CheckoutForm(t(".mphb_sc_checkout-form"));var e=t(".mphb-calendar.mphb-datepick");t.each(e,function(e,a){new MPHB.RoomTypeCalendar(t(a))});var a=t(".mphb-booking-form");t.each(a,function(e,a){new MPHB.ReservationForm(t(a))});var i=t("form.mphb_sc_search-form,form.mphb_widget_search-form");t.each(i,function(e,a){new MPHB.SearchForm(t(a))})})}(jQuery);